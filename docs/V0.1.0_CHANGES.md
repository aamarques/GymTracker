# Version 0.1.0 - Multi-Tenant System with Roles

## Overview

Version 0.1.0 transforms the Gym Tracker from a single-user application to a **multi-tenant system** supporting:
- **Personal Trainers** who manage exercise libraries and clients
- **Clients** who receive assigned exercises and create workout plans
- **Internationalization** supporting English and Portuguese

---

## Major Changes

### 1. User Role System

**New User Roles:**
- `PERSONAL_TRAINER` - Can create exercises, manage clients, assign exercises
- `CLIENT` - Can view assigned exercises, create workout plans, track workouts

**Database Changes:**
- Added `role` column (ENUM: personal_trainer, client)
- Added `language` column (VARCHAR: en, pt)
- Added `personal_trainer_id` column for client-trainer relationship

**Files Modified:**
- `backend/app/models/models.py` - Added UserRole enum and role field
- `backend/app/schemas/schemas.py` - Updated schemas with role validation
- `backend/migrations/0002_add_roles_and_multi_tenant.py` - Migration script

---

### 2. Client-Personal Trainer Relationship

**How it Works:**
- Clients can be assigned to a Personal Trainer during registration
- Personal Trainers can view and manage their assigned clients
- Clients see only exercises assigned by their PT

**New Endpoints:**
- `GET /api/users/clients` - PT gets list of their clients
- `GET /api/users/clients/{client_id}` - PT gets client details

**Files Modified:**
- `backend/app/models/models.py` - Added self-referential relationship
- `backend/app/api/users.py` - Added client management endpoints

---

### 3. Exercise Library Restrictions

**Access Control:**
- **Personal Trainers:** Can create, edit, delete exercises in their library
- **Clients:** Can only view exercises assigned to them by their PT

**Updated Endpoints:**
- `POST /api/exercises` - Personal Trainers only
- `GET /api/exercises` - Role-based filtering
- `PUT /api/exercises/{id}` - PT can only edit own exercises
- `DELETE /api/exercises/{id}` - PT can only delete own exercises

**Files Modified:**
- `backend/app/core/permissions.py` - Created role-based access control utilities
- `backend/app/api/exercises.py` - Added permission checks

---

### 4. Exercise Assignment System

**How it Works:**
1. Personal Trainer creates exercises in their library
2. PT selects a client and assigns specific exercises to them
3. Client sees only assigned exercises in their exercise list
4. Client can use assigned exercises in workout plans

**New Table: `assigned_exercises`**
```sql
CREATE TABLE assigned_exercises (
    id VARCHAR PRIMARY KEY,
    exercise_id VARCHAR REFERENCES exercises(id),
    client_id VARCHAR REFERENCES users(id),
    personal_trainer_id VARCHAR REFERENCES users(id),
    assigned_at TIMESTAMP,
    notes TEXT
);
```

**New Endpoints:**
- `POST /api/exercises/assign` - PT assigns exercise to client
- `GET /api/exercises/assigned/{client_id}` - PT views client's assigned exercises
- `DELETE /api/exercises/assign/{assignment_id}` - PT removes assignment

**Files Modified:**
- `backend/app/models/models.py` - Added AssignedExercise model
- `backend/app/schemas/schemas.py` - Added assignment schemas
- `backend/app/api/exercises.py` - Added assignment endpoints

---

### 5. Internationalization (i18n)

**Supported Languages:**
- **English (en)** - Default
- **Portuguese (pt)**

**Features:**
- User can select language during registration
- User can change language in profile settings
- Frontend automatically displays in user's preferred language
- All UI text is translatable

**Translation Keys Organized by Section:**
- Navigation (nav.*)
- Authentication (auth.*)
- Dashboard (dashboard.*)
- Exercises (exercises.*, muscle.*)
- Workout Plans (plans.*)
- Profile & Health (profile.*, health.*)
- Clients (clients.*)
- Common (common.*)

**New Files:**
- `frontend/js/i18n.js` - Translation system with 180+ translated strings

**API Changes:**
- Added `language` field to User model (default: 'en')
- Language validation in UserCreate and UserUpdate schemas

---

## Database Schema Changes

### Users Table

```sql
ALTER TABLE users
ADD COLUMN role userrole NOT NULL DEFAULT 'client',
ADD COLUMN language VARCHAR(2) NOT NULL DEFAULT 'en',
ADD COLUMN personal_trainer_id VARCHAR REFERENCES users(id);
```

### Exercises Table

```sql
ALTER TABLE exercises
ALTER COLUMN created_by SET NOT NULL,
ADD CONSTRAINT exercises_created_by_fkey FOREIGN KEY (created_by) REFERENCES users(id);
```

### New Table: Assigned Exercises

```sql
CREATE TABLE assigned_exercises (
    id VARCHAR PRIMARY KEY,
    exercise_id VARCHAR NOT NULL REFERENCES exercises(id) ON DELETE CASCADE,
    client_id VARCHAR NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    personal_trainer_id VARCHAR NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    notes TEXT,
    UNIQUE(exercise_id, client_id)
);
```

---

## API Endpoints Summary

### New Endpoints

**Client Management (Personal Trainers):**
- `GET /api/users/clients` - List all my clients
- `GET /api/users/clients/{client_id}` - Get client details

**Exercise Assignment (Personal Trainers):**
- `POST /api/exercises/assign` - Assign exercise to client
- `GET /api/exercises/assigned/{client_id}` - Get client's assigned exercises
- `DELETE /api/exercises/assign/{assignment_id}` - Remove assignment

### Modified Endpoints

**Exercises (Role-Based Access):**
- `POST /api/exercises` - ‚úÖ PT only
- `GET /api/exercises` - ‚úÖ PT sees their library, Clients see assigned
- `GET /api/exercises/{id}` - ‚úÖ Role-based visibility
- `PUT /api/exercises/{id}` - ‚úÖ PT only (own exercises)
- `DELETE /api/exercises/{id}` - ‚úÖ PT only (own exercises)

**Users:**
- `PUT /api/users/profile` - ‚úÖ Now includes language update

---

## Workflow Examples

### Scenario 1: Personal Trainer Creates Exercise Library

1. PT registers with `role: "personal_trainer"`
2. PT logs in and navigates to Exercises
3. PT creates exercises (e.g., "Bench Press", "Squat", "Deadlift")
4. Exercises are stored in PT's personal library

### Scenario 2: Client Registration with Personal Trainer

1. Client registers with `role: "client"`
2. Client optionally provides `personal_trainer_id` (PT's user ID)
3. Client logs in but sees empty exercise library (no exercises assigned yet)

### Scenario 3: PT Assigns Exercises to Client

1. PT navigates to "My Clients"
2. PT selects a client
3. PT clicks "Assign Exercises"
4. PT selects exercises from their library
5. PT adds optional notes for each exercise
6. Client can now see assigned exercises

### Scenario 4: Client Creates Workout Plan

1. Client navigates to "Workout Plans"
2. Client creates new plan
3. Client adds exercises (only sees PT-assigned exercises)
4. Client sets sets, reps, rest time, and weight for each exercise
5. Client saves and activates the plan

### Scenario 5: Language Switching

1. User goes to Profile
2. User selects language (English or Portuguese)
3. UI immediately updates to selected language
4. Language preference is saved in database

---

## Migration Steps

### To Apply This Version:

1. **Stop containers:**
   ```bash
   podman stop gym_nginx gym_backend gym_postgres
   ```

2. **Rebuild backend image:**
   ```bash
   cd ~/Gym/GymTracker
   podman build -t localhost/gym_backend:latest backend/
   ```

3. **Start containers:**
   ```bash
   bash start-containers.sh
   ```

4. **Verify migration:**
   ```bash
   podman logs gym_backend | grep migration
   ```

   Expected output:
   ```
   Running database migrations...
   Found 2 migration(s)
   ‚úì All migrations applied successfully
   ```

---

## Breaking Changes

‚ö†Ô∏è **Important:** Existing users will need to be updated:

1. **All existing users default to `role: 'client'`**
2. **Existing exercises need `created_by` field populated**
3. **Clients will see empty exercise library until PT assigns exercises**

### Data Migration for Existing Users

If you have existing users, run this SQL to promote them to Personal Trainers:

```sql
UPDATE users
SET role = 'personal_trainer'
WHERE email = 'your-pt-email@example.com';
```

For existing exercises without `created_by`:

```sql
-- Assign all existing exercises to a specific PT
UPDATE exercises
SET created_by = (SELECT id FROM users WHERE role = 'personal_trainer' LIMIT 1)
WHERE created_by IS NULL;
```

---

## Testing Checklist

### Personal Trainer Flow:
- [ ] Register as Personal Trainer
- [ ] Login successfully
- [ ] Create multiple exercises with images
- [ ] View exercise library (see only own exercises)
- [ ] Edit own exercise
- [ ] Delete own exercise
- [ ] View "My Clients" (empty initially)
- [ ] Assign exercises to client (after client registers)
- [ ] View assigned exercises for specific client

### Client Flow:
- [ ] Register as Client (with PT ID)
- [ ] Login successfully
- [ ] View exercises (empty initially)
- [ ] View exercises after PT assignment
- [ ] Create workout plan using assigned exercises
- [ ] Cannot access exercise creation/editing
- [ ] View health metrics
- [ ] Change language to Portuguese

### Internationalization:
- [ ] Register with language: "pt"
- [ ] UI displays in Portuguese
- [ ] Switch to English in Profile
- [ ] All labels update correctly
- [ ] Login/Register forms show correct language

---

## Next Steps (v0.2.0+)

Potential future enhancements:

1. **Client Invitations:** PT can send email invitations to clients
2. **Workout Templates:** PT can create workout plan templates for clients
3. **Progress Tracking:** PT can view client workout history and progress
4. **Messaging System:** In-app chat between PT and clients
5. **Additional Languages:** Spanish, French, German, etc.
6. **Mobile App:** React Native or Flutter app
7. **Payment Integration:** Subscription management for PT-client relationships

---

## Files Changed

### Backend Files:
- ‚úÖ `app/models/models.py` - Added UserRole, relationships, AssignedExercise
- ‚úÖ `app/schemas/schemas.py` - Updated schemas with role, language, assignments
- ‚úÖ `app/core/permissions.py` - Created (role-based access control)
- ‚úÖ `app/api/exercises.py` - Added role checks and assignment endpoints
- ‚úÖ `app/api/users.py` - Added client management endpoints
- ‚úÖ `migrations/0002_add_roles_and_multi_tenant.py` - Created migration

### Frontend Files:
- ‚úÖ `js/i18n.js` - Created (internationalization system)

### Documentation:
- ‚úÖ `docs/V0.1.0_CHANGES.md` - This file

---

## Summary

Version 0.1.0 successfully transforms the Gym Tracker into a **professional multi-tenant fitness management platform** where:

- **Personal Trainers** manage their exercise libraries and client relationships
- **Clients** receive personalized exercise assignments and track their progress
- **Both roles** can use the system in their preferred language (English or Portuguese)

The system maintains data isolation (PTs see their own exercises, clients see assigned exercises) while enabling collaboration through the assignment system.

**Migration:** Automatically runs via yoyo-migrations on container startup
**Backward Compatibility:** Existing data defaults to 'client' role, may need manual adjustment
**Language Support:** Full UI translation for English and Portuguese

üöÄ **Ready for deployment!**
